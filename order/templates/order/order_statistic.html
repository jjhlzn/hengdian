{% extends "order/base_generic.html" %}
{% load static from staticfiles %}
{% load hengdian_extras %}

{% block title %}订单统计{% endblock %}

{% block content %}
<div style="width:100%">
			<div class="row">
				 <div class="col-md-8"></div>
				 <div class="col-md-1"></div>
				 <div class="col-md-1"></div>
				 <div class="col-md-1"></div>
				 <div class="dropdown col-md-1">
					  <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown">
						指标
						<span class="caret"></span>
					  </button>
					  <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                        <li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="change_dataset('success_order_count')">订单数</a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="change_dataset('total_people_num')">人数</a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#" onclick="change_dataset('total_money')">营收</a></li>
						<li role="presentation" class="divider"></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">手机订单</a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">门票订单数</a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">酒店订单数</a></li>
						<li role="presentation"><a role="menuitem" tabindex="-1" href="#">套餐订单数</a></li>
					  </ul>
				</div>
			</div>
			<div>
			<canvas id="canvas" height="300" width="600"></canvas>
			</div>


</div>
{% endblock %}
{% block javascript %}
	<script src="{% static "order/js/Chart.js" %}"></script>
	<script>
		var lineChartData = {
			labels : [
			{% for item in data1 %} "{% cycle item.order_date "" "" "" "" "" "" "" "" "" "" "" "" "" "" ""  %}", {% endfor %}
			],
			datasets : [
				{
					label: "this year order info",
                    fillColor: "rgba(151,187,205,0.2)",
                    strokeColor: "rgba(151,187,205,1)",
                    pointColor: "rgba(151,187,205,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(151,187,205,1)",
					pointDot : false,
					data : 
					[
					{% for item in data0 %}  "{{item.people_count}}", {% endfor %}
					]
				},
                {
					label: "2013 year order info",
					fillColor : "rgba(220,220,220,0.2)",
					strokeColor : "rgba(220,220,220,1)",
					pointColor : "rgba(220,220,220,1)",
					pointStrokeColor : "#fff",
					pointHighlightFill : "#fff",
					pointHighlightStroke : "rgba(220,220,220,1)",
					pointDot : false,
					data :
					[
					{% for item in data1 %}  "{{item.people_count}}", {% endfor %}
					]
				}
			]
		}

		var total_people_num_datasets = [
                    [{% for item in data0 %} "{{item.people_count}}", {% endfor %}],
                    [{% for item in data1 %} "{{item.people_count}}", {% endfor %}]
		];
        var success_orders_datasets = [
					[{% for item in data0 %}  "{{item.success_order_count}}", {% endfor %}],
                    [{% for item in data1 %}  "{{item.success_order_count}}", {% endfor %}]
		];
        var total_money_datasets = [
					[{% for item in data0 %}  "{{item.total_money}}", {% endfor %}],
                    [{% for item in data1 %}  "{{item.total_money}}", {% endfor %}]
		];

		window.onload = function(){
			var ctx = document.getElementById("canvas").getContext("2d");
			window.myLine = new Chart(ctx).Line(lineChartData, {
                                         responsive: true,
			                             pointHitDetectionRadius: 1,
                                         pointDot : false});
        };
		
		function change_dataset(type) {
            //alert(window.myLine);
            window.myLine.destroy();
            if (type == 'total_people_num') {
                //alert('people_num');
                lineChartData.datasets[0].data = total_people_num_datasets[0];
                lineChartData.datasets[1].data = total_people_num_datasets[1];
            } else if (type == 'total_money') {
                lineChartData.datasets[0].data = total_money_datasets[0];
                lineChartData.datasets[1].data = total_money_datasets[1];
            } else {
                lineChartData.datasets[0].data = success_orders_datasets[0];
                lineChartData.datasets[1].data = success_orders_datasets[1];
            }
            var ctx = document.getElementById("canvas").getContext("2d");
			window.myLine = new Chart(ctx).Line(lineChartData, {
                                                    responsive: true,
			                                        pointHitDetectionRadius: 1,
                                                    pointDot : false});
        }

	</script>
{% endblock %}
